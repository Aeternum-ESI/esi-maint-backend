model Asset {
    id            Int         @id @default(autoincrement())
    locationId    Int?
    categoryId    Int?
    name          String
    inventoryCode String
    status        AssetStatus
    quantity      Int         @default(1)

    subAssets    Asset[]                 @relation("AssetLocation")
    reports      Report[]
    assignements TechnicianAssignement[]

    parentAsset Asset?    @relation(fields: [locationId], references: [id], name: "AssetLocation")
    category    Category? @relation(fields: [categoryId], references: [id], onUpdate: SetNull)

    createdAt DateTime @default(now())
    updatedAt DateTime @updatedAt
}

model Category {
    id          Int     @id @default(autoincrement())
    name        String  @unique
    description String?
    parentId    Int?

    assets Asset[]

    // Self-relation for category hierarchy
    children Category[] @relation("CategoryChildren")
    parent   Category?  @relation("CategoryChildren", fields: [parentId], references: [id], onDelete: Cascade)

    Report Report[]

    // Relations to closure table
    ancestors   CategoryClosure[] @relation("CategoryAncestors")
    descendants CategoryClosure[] @relation("CategoryDescendants")

    createdAt DateTime @default(now())
    updatedAt DateTime @updatedAt
}

model CategoryClosure {
    ancestorId   Int
    descendantId Int
    depth        Int

    ancestor   Category @relation("CategoryAncestors", fields: [ancestorId], references: [id], onDelete: Cascade)
    descendant Category @relation("CategoryDescendants", fields: [descendantId], references: [id], onDelete: Cascade)

    @@id([ancestorId, descendantId])
}

enum AssetStatus {
    OPERATIONAL
    UNDER_MAINTENANCE
}
